version: '3.9'

services:
  php:
    build:
      context: .
    env_file:
      - ./.docker/php.env.development
    environment:
      PHP_IDE_CONFIG: "serverName=localhost"
    volumes:
      - ./app:/srv/app
      - ./.docker/php/development:/usr/local/etc/php
         #- ~/.ssh/:/home/root/.ssh

  web:
    image: nginx:1.19-alpine
    working_dir: /srv/app
    environment:
      TERM: Linux
    volumes:
      - ./app:/srv/app
      - ./.docker/nginx:/etc/nginx/conf.d
    ports:
      - "8080:80"
    depends_on:
      - php

  db:
    image: mysql:latest
    container_name: mysql
    tty: true
    ports:
      - "3306:3306"
    volumes:
      - ./data/mysql:/var/lib/mysql
    environment:
      MYSQL_DATABASE: cakephp
      MYSQL_USER: cakephp 
      MYSQL_PASSWORD: cakephp
      MYSQL_ROOT_PASSWORD: root

  composer:
    build:
      context: .
      args:
        - UID=${UID:-1000}
        - GID=${GID:-1000}
    container_name: cake-composer
    volumes:
      - ./:/srv/app
    working_dir: /srv/app
    entrypoint: ['composer', '--ignore-platform-reqs']

volumes:
  data:

